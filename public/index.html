<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Make It Matter CRM</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f4f6f8; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h2 { margin-top: 0; color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .tag { padding: 4px 8px; border-radius: 12px; font-size: 0.8em; font-weight: bold; }
        .tag.won { background: #e6fffa; color: #00b37e; }
        button { background: #0066cc; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0050a3; }
    </style>
</head>
<body>
    <h1>Make It Matter CRM + PM ðŸš€</h1>
    <div class="container">
        <div class="card"><h2>Organisaties</h2><div id="org-list">Laden...</div></div>
        <div class="card"><h2>Deals (Sales)</h2><div id="deal-list">Laden...</div></div>
        <div class="card"><h2>Projecten & Taken</h2><div id="project-list">Laden...</div></div>
    </div>

    <script>
        async function loadData() {
            const res = await fetch('/api/dashboard');
            const data = await res.json();
            
            document.getElementById('org-list').innerHTML = data.orgs.map(org => 
                `<div class="item"><strong>${org.name}</strong><span style="color:#666">${org.industry}</span></div>`).join('');

            document.getElementById('deal-list').innerHTML = data.deals.map(deal => `
                <div class="item">
                    <div><strong>${deal.title}</strong><br><small>â‚¬${deal.amount}</small></div>
                    ${deal.stage !== 'won' ? `<button onclick="winDeal('${deal.id}')">Win!</button>` : `<span class="tag won">WON</span>`}
                </div>`).join('');

            document.getElementById('project-list').innerHTML = data.projects.map(proj => {
                const projectTasks = data.tasks.filter(t => t.project_id === proj.id);
                return `<div class="item" style="display:block"><strong style="color:#0066cc">${proj.title}</strong>
                        <ul style="margin: 5px 0 0 20px; padding:0; font-size:0.9em; color:#555;">
                        ${projectTasks.map(t => `<li>${t.title}</li>`).join('')}</ul></div>`
            }).join('');
        }
        async function winDeal(id) {
            if(!confirm("Deal winnen?")) return;
            await fetch(`/api/deals/${id}/win`, { method: 'PUT' });
            loadData();
        }
        loadData();
    </script>
</body>
</html>